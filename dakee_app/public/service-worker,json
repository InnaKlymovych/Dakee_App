const version ="1.0.0";

const CACHE_NAME = "Dakee_App"

const cacheAssets = [
   "/public/",
   "/public/index.html",
   "/public/manifest.json"
];

self.addEventListener("install", async (event) => {
   const cache = await caches.open(CACHE_NAME);
   await cache.addAll(cacheAssets);
   await self.skipWaiting();

   await cache.put("version", new Response(VERSION));
})

self.addEventListener("activate", async (event) => {
   const oldCache = await caches.open(CACHE_NAME);
   if(oldCache) await oldCache.delete(CACHE_NAME);

   const cache = await caches.open(CACHE_NAME);
   const cachedVersion = await cache.match("version");
   const currentVersion = new Response(VERSION);

   if (cachedVersion != currentVersion) {
      await clients.claim();
      await self.clients.matchAll({ type: "window" }),then((clients) => {
         clients.forEach((client) => client.navigate(client.url));
      });
   }
});
self.addEventListener("fetch", async (event) => {
   const responsePromise = (async () =>{
         const cachedResponse = await caches.match(event.request);
         return cachedResponse || fetch(event.request);
   })();


   event.respondWith(responsePromise);
});